import{u as A,a as f}from"./useRequest.cde6ea3c.js";import{u as C,v as E}from"./cloneDeep.bd3abae2.js";import{D as O,h as $,E as s,G as q,br as z}from"./entry.db0d2505.js";const N=()=>{const{loading:I,loadingBtn:S,setLoadingBtn:v,setLoading:p}=A(!1),x=O(),h=$(()=>x.options.messageRef),R={title:[e=>e?!0:"标题不能为空"]},_=[{value:20,title:"20"},{value:50,title:"50"},{value:100,title:"100"}],B=[{title:"序号",key:"index",align:"center",sortable:!1},{title:"名称",key:"name",align:"center",sortable:!1},{title:"创建时间",key:"createTime",align:"center",sortable:!1},{title:"操作",key:"actions",align:"end",sortable:!1}],i=s(!1),d=s(1),b=s(20),y=s(0),r=s("添加文章"),D=s([]),g=s([]),k=s(),P=s(),t=q({id:null,uid:null,title:"",content:""}),L=()=>{},m=({page:e,itemsPerPage:o,sortBy:u}={page:d.value,itemsPerPage:b.value})=>{p(!0),f({url:`/api/blog/book?pageSize=${o}&page=${e}`}).then(({data:n,message:a})=>{g.value=n.map(l=>{for(let c in l)if(c.includes("_")){const M=C(c);l[M]=E(l[c]),delete l[c]}return l}),y.value=+a||0}).finally(()=>{p(!1)})},w=()=>{t.title="",t.content=""};return{rules:R,loading:I,itemsPerPage:b,headers:B,serverItems:g,totalItems:y,selected:D,visible:i,loadingBtn:S,title:r,editorData:t,textFieldRef:k,messageBoxRef:P,itemsPerPageOptions:_,page:d,handleAdd:()=>{w(),r.value="添加文章",i.value=!0},handleSearch:L,loadItems:m,editItem:e=>{t.id=e.id,t.uid=e.uid,t.title=e.name,t.content=e.detail,r.value="修改文章",i.value=!0},deleteItem:e=>{P.value.confirm({text:"是否确认删除该文章？",beforeClose:()=>new Promise(o=>{const{id:u,uid:n,name:a}=e;f({url:"/api/blog/book",method:"delete",body:{id:u,uid:n,name:a}}).then(()=>{h.value.showMsg({type:"success",message:"已删除"}),z(g.value,d.value),m()}).finally(()=>{o(!0)})})})},handleSave:()=>{k.value.validate().then(({valid:e})=>{if(e){v(!0);const{title:o,content:u}=t;let n="post";const a={name:o,detail:u};r.value==="修改文章"&&(n="put",a.id=t.id,a.uid=t.uid),f({url:"/api/blog/book",method:n,body:a}).then(l=>{h.value.showMsg({type:"success",message:l.message}),m(),i.value=!1}).finally(()=>{v(!1)})}})}}};export{N as useManageSetup};
